{"version":3,"file":"angular-build-config.js","sourceRoot":"","sources":["../src/angular-build-config.ts"],"names":[],"mappings":"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","sourcesContent":["// Ref: https://webpack.js.org/configuration/\r\n// ReSharper disable InconsistentNaming\r\nimport * as path from 'path';\r\nimport * as fs from 'fs';\r\n\r\n// Webpack built-in plugins\r\nconst ContextReplacementPlugin = require('webpack/lib/ContextReplacementPlugin');\r\nconst NormalModuleReplacementPlugin = require('webpack/lib/NormalModuleReplacementPlugin');\r\nconst LoaderOptionsPlugin = require('webpack/lib/LoaderOptionsPlugin');\r\n\r\n// Typescript plugins\r\n//import { AotPlugin } from '@ngtools/webpack';\r\n// Or\r\n//import { CheckerPlugin } from 'awesome-typescript-loader';\r\n//import { TsConfigPathsPlugin } from 'awesome-typescript-loader';\r\n// ReSharper disable CommonJsExternalModule\r\nconst { CheckerPlugin } = require('awesome-typescript-loader');\r\nconst TsConfigPathsPlugin = require('awesome-typescript-loader').TsConfigPathsPlugin;\r\n// ReSharper restore CommonJsExternalModule\r\n\r\n\r\n// Other plugins\r\nconst webpackMerge = require('webpack-merge');\r\n\r\n// Local\r\nimport { AngularAppConfig, AngularBuildOptions } from './models';\r\nimport { readJsonSync, isDevelopmentBuild, isDllBuildFromNpmEvent, isAoTBuildFromNpmEvent } from './utils';\r\nimport { getWebpackCommonConfig } from './webpack-build-common';\r\n\r\nconst defaultAppConfig = {\r\n    root: 'src',\r\n    outDir: 'wwwroot'\r\n};\r\n\r\nexport function getWebpackAngularConfigs(projectRoot: string, configPath?: string, buildOptions?: AngularBuildOptions) {\r\n  projectRoot = projectRoot || process.cwd();\r\n\r\n  let configFileExists = false;\r\n  configPath = configPath || 'angular-build.json';\r\n  if (!fs.existsSync(path.resolve(projectRoot, configPath))) {\r\n    const tmpConfigPath = 'angular-cli.json';\r\n    if (fs.existsSync(path.resolve(projectRoot, tmpConfigPath))) {\r\n      configPath = tmpConfigPath;\r\n      configFileExists = true;\r\n    }\r\n  } else {\r\n    configFileExists = true;\r\n  }\r\n\r\n  if (!configFileExists) {\r\n    throw new Error(`'angular-build.json' or 'angular-cli.json' file cound not be found at project root ${projectRoot}.`);\r\n  }\r\n\r\n  const appsConfig = readJsonSync(path.resolve(projectRoot, configPath));\r\n  buildOptions = buildOptions || {};\r\n  buildOptions.dll = typeof buildOptions.dll === 'undefined' ? isDllBuildFromNpmEvent() : buildOptions.dll;\r\n\r\n  // Extends\r\n  const appConfigs = appsConfig.apps.map((app: AngularAppConfig) => {\r\n    let cloneApp = Object.assign({}, app);\r\n    if (cloneApp.extends) {\r\n      const baseApps = appsConfig.apps.filter((a: AngularAppConfig) => a.name === cloneApp.extends);\r\n      if (baseApps && baseApps.length > 0) {\r\n        const cloneBaseApp = Object.assign({}, baseApps[0]);\r\n        cloneApp = Object.assign({}, cloneBaseApp, cloneApp);\r\n      }\r\n    }\r\n    return cloneApp;\r\n  });\r\n\r\n  return appConfigs.filter((app: AngularAppConfig) => (app.enabled || (typeof app.enabled === 'undefined')) &&\r\n    (!buildOptions.dll ||\r\n    (buildOptions.dll && app.dlls && app.dlls.length && (typeof app.skipOnDllBuild === 'undefined' || !app.skipOnDllBuild))\r\n    ))\r\n    .map((app: AngularAppConfig) => {\r\n      const cloneBuildOption = Object.assign({}, buildOptions);\r\n      return getWebpackAngularConfig(projectRoot, app, cloneBuildOption);\r\n    });\r\n}\r\n\r\nexport function getWebpackAngularConfig(projectRoot: string, appConfig: AngularAppConfig, buildOptions?: AngularBuildOptions) {\r\n  projectRoot = projectRoot || process.cwd();\r\n  buildOptions = buildOptions || {};\r\n  buildOptions.debug = typeof buildOptions.debug === 'undefined' ? isDevelopmentBuild() : buildOptions.debug;\r\n  buildOptions.dll = typeof buildOptions.dll === 'undefined' ? isDllBuildFromNpmEvent() : buildOptions.dll;\r\n  buildOptions.aot = typeof buildOptions.aot === 'undefined' ? isAoTBuildFromNpmEvent() : buildOptions.aot;\r\n\r\n  if (!appConfig) {\r\n    throw new Error(`'appConfig' is required.`);\r\n  }\r\n  if (typeof appConfig !== 'object') {\r\n    throw new Error(`Invalid 'appConfig'.`);\r\n  }\r\n  if (!appConfig.root) {\r\n    throw new Error(`'appConfig.root' value is required.`);\r\n  }\r\n  if (!appConfig.outDir) {\r\n    throw new Error(`'appConfig.outDir' value is required.`);\r\n  }\r\n  if (!buildOptions.dll && !appConfig.main) {\r\n    throw new Error(`'appConfig.main' value is required.`);\r\n  }\r\n  if (buildOptions.dll && !appConfig.dlls) {\r\n    throw new Error(`'appConfig.dlls' value is required.`);\r\n  }\r\n\r\n  if (buildOptions.dll && appConfig.skipOnDllBuild) {\r\n    return null;\r\n  }\r\n\r\n  const appRoot = path.resolve(projectRoot, appConfig.root);\r\n  const tsConfigPath = path.resolve(projectRoot, appConfig.root, appConfig.tsconfig || 'tsconfig.json');\r\n\r\n  let emptyModulePath = buildOptions['emptyModule'];\r\n  if (!emptyModulePath) {\r\n    emptyModulePath = path.resolve(projectRoot, 'empty.js');\r\n    if (!fs.existsSync(emptyModulePath)) {\r\n      emptyModulePath = path.resolve(projectRoot, appConfig.root, 'empty.js');\r\n    }\r\n    if (!fs.existsSync(emptyModulePath)) {\r\n      emptyModulePath = require.resolve('./empty.js');\r\n    }\r\n    if (!fs.existsSync(emptyModulePath)) {\r\n      emptyModulePath = require.resolve('../empty.js');\r\n    }\r\n    // ts\r\n    if (!fs.existsSync(emptyModulePath)) {\r\n      emptyModulePath = path.resolve(projectRoot, 'empty.ts');\r\n    }\r\n    if (!fs.existsSync(emptyModulePath)) {\r\n      emptyModulePath = path.resolve(projectRoot, appConfig.root, 'empty.ts');\r\n    }\r\n    if (!fs.existsSync(emptyModulePath)) {\r\n      emptyModulePath = require.resolve('./empty.ts');\r\n    }\r\n    if (!fs.existsSync(emptyModulePath)) {\r\n      emptyModulePath = require.resolve('../empty.ts');\r\n    }\r\n    buildOptions['emptyModule'] = emptyModulePath;\r\n  }\r\n\r\n  const rules: any = [];\r\n  const plugins: any = [];\r\n\r\n  const commonConfig = getWebpackCommonConfig(projectRoot, appConfig, buildOptions);\r\n\r\n  // rules\r\n  //\r\n  if (!buildOptions.dll) {\r\n\r\n    // Typescript rules, AoT and Non-AoT\r\n    const tsRules = [\r\n      {\r\n        test: /\\.ts$/,\r\n        use: [\r\n          //'@angularclass/hmr-loader?pretty=' + buildOptions.debug + '&prod=' + !buildOptions.debug,\r\n          //'awesome-typescript-loader?{configFileName: \"' + tsConfigPath + '\", instance: \"at-' + appConfig.name || 'app' +'-loader\"}',\r\n          {\r\n            loader: 'awesome-typescript-loader',\r\n            options: {\r\n              instance: `at-${appConfig.name || 'app'}-loader`,\r\n              configFileName: tsConfigPath\r\n            }\r\n          },\r\n          {\r\n            loader: 'string-replace-loader',\r\n            options: {\r\n              search: 'moduleId:\\s*module.id\\s*[,]?',\r\n              replace: '',\r\n              flags: 'g'\r\n            }\r\n          },\r\n          //{\r\n          //    test: /\\.ts$/,\r\n          //    loader: 'string-replace-loader',\r\n          //    query: {\r\n          //        search: '(System|SystemJS)(.*[\\\\n\\\\r]\\\\s*\\\\.|\\\\.)import\\\\((.+)\\\\)',\r\n          //        replace: '$1.import($3).then(mod => (mod.__esModule && mod.default) ? mod.default : mod)',\r\n          //        flags: 'g'\r\n          //    },\r\n          //    include: [appRoot]\r\n          //},\r\n          'angular2-template-loader',\r\n          //'angular-router-loader?loader=system&genDir=aot-compiled/src/app&aot=' + buildOption.aot\r\n          {\r\n              loader: 'angular2-router-loader',\r\n              options: {\r\n                loader: 'system'\r\n                  //TODO: to review\r\n                  //aot: buildOptions.aot,\r\n                  //genDir: 'aot-compiled/src/app'\r\n              }\r\n          }\r\n        ],\r\n        //include: [appRoot]\r\n        exclude: [/\\.(spec|e2e|e2e-spec)\\.ts$/]\r\n      }\r\n      // TODO: to review\r\n      // Or\r\n      //{\r\n      //    test: /\\.ts$/,\r\n      //    loader: '@ngtools/webpack',\r\n      //    exclude: [/\\.(spec|e2e|e2e-spec)\\.ts$/]\r\n      //}\r\n    ];\r\n    rules.push(...tsRules);\r\n  }\r\n\r\n  // plugins\r\n  //\r\n  // fix angular2\r\n  const angular2fixPlugins = [\r\n\r\n    // see:  https://github.com/angular/angular/issues/11580\r\n    new ContextReplacementPlugin(\r\n      // The (\\\\|\\/) piece accounts for path separators in *nix and Windows\r\n      /angular(\\\\|\\/)core(\\\\|\\/)(esm(\\\\|\\/)src|src)(\\\\|\\/)linker/,\r\n      appRoot\r\n      //resolveNgRoute(root(options.srcRoot))\r\n    ),\r\n\r\n    new NormalModuleReplacementPlugin(\r\n        /facade(\\\\|\\/)async/,\r\n        path.resolve(projectRoot, 'node_modules/@angular/core/src/facade/async.js')\r\n    ),\r\n    new NormalModuleReplacementPlugin(\r\n        /facade(\\\\|\\/)collection/,\r\n        path.resolve(projectRoot, 'node_modules/@angular/core/src/facade/collection.js')\r\n    ),\r\n    new NormalModuleReplacementPlugin(\r\n        /facade(\\\\|\\/)errors/,\r\n        path.resolve(projectRoot, 'node_modules/@angular/core/src/facade/errors.js')\r\n    ),\r\n    new NormalModuleReplacementPlugin(\r\n        /facade(\\\\|\\/)lang/,\r\n        path.resolve(projectRoot, 'node_modules/@angular/core/src/facade/lang.js')\r\n    ),\r\n    new NormalModuleReplacementPlugin(\r\n        /facade(\\\\|\\/)math/,\r\n        path.resolve(projectRoot, 'node_modules/@angular/core/src/facade/math.js')\r\n    )\r\n  ];\r\n  plugins.push(...angular2fixPlugins);\r\n\r\n  if (!buildOptions.dll) {\r\n    // Typescript plugins, Aot and Non-Aot\r\n    //\r\n    const tsPlugins = [\r\n        new CheckerPlugin()\r\n    ];\r\n    plugins.push(...tsPlugins);\r\n    // Or\r\n    //if (buildOptions.aot) {\r\n    //    const aotPlugins = [\r\n    //        new AotPlugin({\r\n    //            tsConfigPath: tsConfigPath,\r\n    //            mainPath: path.join(projectRoot, appConfig.root, appConfig.main),\r\n    //            i18nFile: appConfig.i18nFile,\r\n    //            i18nFormat: appConfig.i18nFormat,\r\n    //            locale: appConfig.locale,\r\n    //            exclude: [\r\n    //                path.join(projectRoot, appConfig.root, appConfig.test || 'test.ts'),\r\n    //                '**/*.spec.ts'\r\n    //            ]\r\n    //        })\r\n    //    ];\r\n    //    plugins.push(...aotPlugins);\r\n    //} else {\r\n    //    const nonAoTPlugins = [\r\n    //        //new AotPlugin({\r\n    //        //    tsConfigPath: tsConfigPath,\r\n    //        //    mainPath: path.join(projectRoot, appConfig.root, appConfig.main),\r\n    //        //    exclude: [\r\n    //        //        path.join(projectRoot, appConfig.root, appConfig.test),\r\n    //        //        '**/*.spec.ts'\r\n    //        //    ],\r\n    //        //    skipCodeGeneration: true\r\n    //        //})\r\n    //    ];\r\n    //    plugins.push(...nonAoTPlugins);\r\n    //}\r\n  }\r\n\r\n  // Ignore plugins\r\n  //\r\n  if (buildOptions.aot || !buildOptions.debug) {\r\n    const prodPlugins = [\r\n      new NormalModuleReplacementPlugin(\r\n        /zone\\.js(\\\\|\\/)dist(\\\\|\\/)long-stack-trace-zone/,\r\n        emptyModulePath\r\n      ),\r\n\r\n      // AoT\r\n      // problem with platformUniversalDynamic on the server/client\r\n      //new IgnorePlugin(/@angular(\\\\|\\/)compiler/),\r\n      // Or\r\n      //new NormalModuleReplacementPlugin(\r\n      //    /@angular(\\\\|\\/)compiler/,\r\n      //    emptyModulePath\r\n      //),\r\n\r\n      // AoT\r\n      // new NormalModuleReplacementPlugin(\r\n      //   /@angular(\\\\|\\/)upgrade/,\r\n      //    emptyModulePath\r\n      // ),\r\n      // new NormalModuleReplacementPlugin(\r\n      //   /@angular(\\\\|\\/)platform-browser-dynamic/,\r\n      //    emptyModulePath\r\n      // ),\r\n      // new NormalModuleReplacementPlugin(\r\n      //   /dom(\\\\|\\/)debug(\\\\|\\/)ng_probe/,\r\n      //    emptyModulePath\r\n      // ),\r\n      // new NormalModuleReplacementPlugin(\r\n      //   /dom(\\\\|\\/)debug(\\\\|\\/)by/,\r\n      //    emptyModulePath\r\n      // ),\r\n      // new NormalModuleReplacementPlugin(\r\n      //   /src(\\\\|\\/)debug(\\\\|\\/)debug_node/,\r\n      //    emptyModulePath\r\n      // ),\r\n      // new NormalModuleReplacementPlugin(\r\n      //   /src(\\\\|\\/)debug(\\\\|\\/)debug_renderer/,\r\n      //    emptyModulePath\r\n      // ),\r\n\r\n      new LoaderOptionsPlugin({\r\n        options: {\r\n           /**\r\n           * Static analysis linter for TypeScript advanced options configuration\r\n           * Description: An extensible linter for the TypeScript language.\r\n           *\r\n           * See: https://github.com/wbuchwalter/tslint-loader\r\n           */\r\n            tslint: {\r\n              emitErrors: true,\r\n              failOnHint: true,\r\n              resourcePath: 'src'\r\n            },\r\n\r\n              /**\r\n               * Html loader advanced options\r\n               *\r\n               * See: https://github.com/webpack/html-loader#advanced-options\r\n               */\r\n              // TODO: Need to workaround Angular 2's html syntax => #id [bind] (event) *ngFor\r\n              htmlLoader: {\r\n                  minimize: true,\r\n                  removeAttributeQuotes: false,\r\n                  caseSensitive: true,\r\n                  customAttrSurround: [\r\n                      [/#/, /(?:)/],\r\n                      [/\\*/, /(?:)/],\r\n                      [/\\[?\\(?/, /(?:)/]\r\n                  ],\r\n                  customAttrAssign: [/\\)?\\]?=/]\r\n              }\r\n\r\n          }\r\n      })\r\n\r\n    ];\r\n\r\n    if (buildOptions.aot) {\r\n      const aotProdPlugins = [\r\n        // AoT\r\n        // problem with platformUniversalDynamic on the server/client\r\n        //new IgnorePlugin(/@angular(\\\\|\\/)compiler/),\r\n        // Or\r\n        new NormalModuleReplacementPlugin(\r\n            /@angular(\\\\|\\/)compiler/,\r\n            emptyModulePath\r\n        )\r\n\r\n        // AoT\r\n        // new NormalModuleReplacementPlugin(\r\n        //   /@angular(\\\\|\\/)upgrade/,\r\n        //    emptyModulePath\r\n        // ),\r\n        // new NormalModuleReplacementPlugin(\r\n        //   /@angular(\\\\|\\/)platform-browser-dynamic/,\r\n        //    emptyModulePath\r\n        // ),\r\n        // new NormalModuleReplacementPlugin(\r\n        //   /dom(\\\\|\\/)debug(\\\\|\\/)ng_probe/,\r\n        //    emptyModulePath\r\n        // ),\r\n        // new NormalModuleReplacementPlugin(\r\n        //   /dom(\\\\|\\/)debug(\\\\|\\/)by/,\r\n        //    emptyModulePath\r\n        // ),\r\n        // new NormalModuleReplacementPlugin(\r\n        //   /src(\\\\|\\/)debug(\\\\|\\/)debug_node/,\r\n        //    emptyModulePath\r\n        // ),\r\n        // new NormalModuleReplacementPlugin(\r\n        //   /src(\\\\|\\/)debug(\\\\|\\/)debug_renderer/,\r\n        //    emptyModulePath\r\n        // ),\r\n      ];\r\n      prodPlugins.push(...aotProdPlugins);\r\n    }\r\n\r\n    //if (typeof buildOptions.replaceHmrOnProduction === 'undefined' || buildOptions.replaceHmrOnProduction) {\r\n    //  prodPlugins.push(new NormalModuleReplacementPlugin(\r\n    //    /angular2-hmr/,\r\n    //    emptyModulePath\r\n    //  ));\r\n    //}\r\n    plugins.push(...prodPlugins);\r\n\r\n  }\r\n\r\n  if (buildOptions.aot && appConfig.mainAoT && commonConfig.entry && commonConfig.entry['main']) {\r\n      const appAoTMain = path.resolve(projectRoot, appConfig.root, appConfig.mainAoT);\r\n      commonConfig.entry['main'] = [appAoTMain];\r\n  }\r\n\r\n  let angularConfig = {\r\n    resolve: {\r\n      extensions: buildOptions.dll ? ['.js'] : ['.ts', '.js', '.json']\r\n    },\r\n    module: {\r\n      rules: rules\r\n    },\r\n    plugins: plugins\r\n  };\r\n  angularConfig = webpackMerge(commonConfig, angularConfig);\r\n\r\n  if (!buildOptions.dll) {\r\n    //const alias = {};\r\n    //if (fs.existsSync(tsConfigPath)) {\r\n    //    const tsConfigContent = readJsonSync(tsConfigPath);\r\n    //    const compilerOptions = tsConfigContent.compilerOptions || {};\r\n    //    const tsPaths = compilerOptions.paths || {};\r\n    //    for (let prop in tsPaths) {\r\n    //        if (tsPaths.hasOwnProperty(prop)) {\r\n    //            alias[prop] = path.resolve(projectRoot, tsPaths[prop][0]);\r\n    //        }\r\n    //    }\r\n    //}\r\n\r\n    angularConfig = webpackMerge(angularConfig, {\r\n        resolve: {\r\n            // alias: alias,\r\n            // Or\r\n            plugins: [\r\n                // TODO: to review\r\n                new TsConfigPathsPlugin({\r\n                    configFileName: tsConfigPath\r\n                })\r\n            ]\r\n        }\r\n    });\r\n  }\r\n  return angularConfig;\r\n}\r\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}