{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../src/webpack/plugins/suppress-entry-chunks-webpack-plugin/index.ts"],"names":[],"mappings":"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","sourcesContent":["// Ref: angular-cli - https://github.com/angular/angular-cli/blob/master/packages/angular-cli/plugins/suppress-entry-chunks-webpack-plugin.ts\r\n\r\n// ExtractTextPlugin leaves behind the entry points, which we might not need anymore\r\n// if they were entirely css. This plugin removes those entry points.\r\n\r\n// ReSharper disable once InconsistentNaming\r\nexport interface SuppressEntryChunksPluginOptions {\r\n    chunks?: string[];\r\n    supressPattern?: RegExp;\r\n    targetHtmlWebpackPluginId?: string;\r\n    assetTagsFilterFunc?: (tag: any) => boolean;\r\n}\r\n\r\nexport class SuppressEntryChunksWebpackPlugin {\r\n    private isTargetHtmlWebpackPlugin = false;\r\n\r\n    constructor(private readonly options: SuppressEntryChunksPluginOptions) {\r\n        if (!options) {\r\n            throw new ReferenceError(`'options' cannot be null or undefined.`);\r\n        }\r\n    }\r\n\r\n    apply(compiler: any): void {\r\n\r\n        compiler.plugin('compilation', (compilation: any) => {\r\n\r\n            compilation.plugin('after-seal', (callback: any) => {\r\n                this.supressAssets(compilation, callback);\r\n            });\r\n\r\n            if (this.options.assetTagsFilterFunc) {\r\n                compilation.plugin('html-webpack-plugin-alter-asset-tags',\r\n                    (htmlPluginArgs: any, callback: any) => {\r\n\r\n                        if (!this.options.targetHtmlWebpackPluginId ||\r\n                            (this.options.targetHtmlWebpackPluginId &&\r\n                                this.options.targetHtmlWebpackPluginId === htmlPluginArgs.plugin.options.id)) {\r\n                            this.isTargetHtmlWebpackPlugin = true;\r\n                        } else {\r\n                            this.isTargetHtmlWebpackPlugin = false;\r\n                        }\r\n                        if (!this.isTargetHtmlWebpackPlugin) {\r\n                            return callback(null, htmlPluginArgs);\r\n                        }\r\n\r\n\r\n                        const filterFn = this.options.assetTagsFilterFunc;\r\n                        htmlPluginArgs.head = htmlPluginArgs.head.filter(filterFn);\r\n                        htmlPluginArgs.body = htmlPluginArgs.body.filter(filterFn);\r\n                        return callback(null, htmlPluginArgs);\r\n                    });\r\n            }\r\n        });\r\n    }\r\n\r\n    supressAssets(compilation: any, callback: any) {\r\n        if (!this.options.chunks || !this.options.supressPattern) {\r\n            callback();\r\n            return;\r\n        }\r\n        compilation.chunks.filter((chunk: any) => this.options.chunks.indexOf(chunk.name) !== -1)\r\n            .forEach((chunk: any) => {\r\n                const newFiles: string[] = [];\r\n                chunk.files.forEach((file: string) => {\r\n                    if (file.match(this.options.supressPattern)) {\r\n                        delete compilation.assets[file];\r\n                    } else {\r\n                        newFiles.push(file);\r\n                    }\r\n                });\r\n                chunk.files = newFiles;\r\n            });\r\n        callback();\r\n        return;\r\n    }\r\n}\r\n"]}